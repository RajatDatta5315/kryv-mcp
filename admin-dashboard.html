<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KRYV Admin</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Syne:wght@700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
:root{--bg:#020408;--s:#0a0f18;--s2:#111824;--b:rgba(56,189,248,.12);--b2:rgba(56,189,248,.28);--a:#38bdf8;--g:#4ade80;--r:#f87171;--y:#fbbf24;--pu:#a78bfa;--t:#e2e8f0;--m:#64748b;--mono:'DM Mono',monospace;--disp:'Syne',sans-serif;--body:'DM Sans',sans-serif;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--t);font-family:var(--body);min-height:100vh;}
body::before{content:'';position:fixed;inset:0;background:linear-gradient(rgba(56,189,248,.02) 1px,transparent 1px),linear-gradient(90deg,rgba(56,189,248,.02) 1px,transparent 1px);background-size:48px 48px;pointer-events:none;}
.w{max-width:1100px;margin:0 auto;padding:0 24px 60px;position:relative;z-index:1;}
nav{display:flex;align-items:center;justify-content:space-between;padding:24px 0 36px;}
.logo{font-family:var(--disp);font-size:18px;font-weight:900;text-decoration:none;color:var(--t);}
.logo span{color:var(--a);}
.nr{display:flex;gap:16px;align-items:center;}
.nr a{font-family:var(--mono);font-size:10px;letter-spacing:.1em;color:var(--m);text-decoration:none;}
.nr a:hover{color:var(--a);}
.pill{display:flex;align-items:center;gap:6px;font-family:var(--mono);font-size:10px;color:var(--g);padding:5px 12px;border:1px solid rgba(74,222,128,.2);background:rgba(74,222,128,.05);border-radius:20px;}
.dot{width:6px;height:6px;border-radius:50%;background:var(--g);animation:p 2s ease-in-out infinite;}
@keyframes p{0%,100%{opacity:1}50%{opacity:.4}}
/* STATS */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:32px;}
.stat{background:var(--s);border:1px solid var(--b);border-radius:12px;padding:20px;}
.st{font-family:var(--mono);font-size:9px;letter-spacing:.12em;color:var(--m);text-transform:uppercase;margin-bottom:8px;}
.sv{font-family:var(--disp);font-size:28px;font-weight:900;color:var(--t);}
.ss{font-size:11px;color:var(--m);margin-top:4px;}
/* RELYX STATUS */
.relyx-box{background:linear-gradient(135deg,rgba(74,222,128,.06),rgba(56,189,248,.04));border:1px solid rgba(74,222,128,.2);border-radius:14px;padding:22px;margin-bottom:28px;display:flex;align-items:center;gap:20px;flex-wrap:wrap;}
.rl{display:flex;align-items:center;gap:12px;}
.r-icon{width:44px;height:44px;border-radius:10px;background:rgba(74,222,128,.1);border:1px solid rgba(74,222,128,.2);display:flex;align-items:center;justify-content:center;font-size:22px;}
.r-name{font-family:var(--disp);font-size:18px;font-weight:900;}
.r-sub{font-size:12px;color:var(--m);}
.r-status{font-family:var(--mono);font-size:11px;color:var(--g);padding:6px 12px;background:rgba(74,222,128,.08);border:1px solid rgba(74,222,128,.2);border-radius:6px;}
.r-cmd{font-family:var(--mono);font-size:11px;color:var(--a);background:var(--s2);border:1px solid var(--b);border-radius:6px;padding:8px 14px;cursor:pointer;transition:border-color .2s;flex:1;min-width:200px;}
.r-cmd:hover{border-color:var(--b2);}
/* LIVE FEED */
.feed{background:var(--s);border:1px solid var(--b);border-radius:12px;margin-bottom:28px;overflow:hidden;}
.feed-head{padding:16px 20px;border-bottom:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;}
.feed-title{font-family:var(--mono);font-size:10px;letter-spacing:.15em;color:var(--a);text-transform:uppercase;}
.feed-body{padding:0;max-height:220px;overflow-y:auto;}
.feed-row{display:flex;align-items:center;gap:12px;padding:10px 20px;border-bottom:1px solid rgba(56,189,248,.04);font-family:var(--mono);font-size:11px;}
.feed-row:last-child{border-bottom:none;}
.ft{color:var(--m);width:60px;flex-shrink:0;}
.fn{color:var(--accent,var(--a));flex:1;}
.fd{color:var(--m);font-size:10px;}
.fst{padding:3px 8px;border-radius:4px;font-size:9px;text-transform:uppercase;}
.fok{background:rgba(74,222,128,.1);color:var(--g);}
.ferr{background:rgba(248,113,113,.1);color:var(--r);}
/* ECOSYSTEM */
.eco-title{font-family:var(--mono);font-size:10px;letter-spacing:.15em;color:var(--m);margin-bottom:16px;text-transform:uppercase;}
.eco-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;margin-bottom:32px;}
.ecard{background:var(--s);border:1px solid var(--b);border-radius:10px;padding:16px;cursor:pointer;transition:all .2s;text-decoration:none;display:block;}
.ecard:hover{border-color:var(--b2);transform:translateY(-1px);}
.ecard.live{border-color:rgba(74,222,128,.25);}
.ecard.building{border-color:rgba(251,191,36,.15);}
.ecard.planned{opacity:.6;}
.ec-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.ec-name{font-family:var(--disp);font-size:13px;font-weight:800;}
.ec-badge{font-family:var(--mono);font-size:8px;padding:2px 7px;border-radius:4px;text-transform:uppercase;}
.blv{color:var(--g);background:rgba(74,222,128,.1);border:1px solid rgba(74,222,128,.2);}
.bbd{color:var(--y);background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.2);}
.bpl{color:var(--m);background:rgba(100,116,139,.1);border:1px solid rgba(100,116,139,.2);}
.ec-desc{font-size:11px;color:var(--m);line-height:1.5;}
.ec-url{font-family:var(--mono);font-size:10px;color:var(--a);margin-top:6px;}
/* TOOL TEST */
.tool-box{background:var(--s);border:1px solid var(--b);border-radius:12px;padding:22px;margin-bottom:28px;}
.tool-title{font-family:var(--mono);font-size:10px;letter-spacing:.15em;color:var(--a);margin-bottom:16px;text-transform:uppercase;}
.tool-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px;margin-bottom:12px;}
.tbtn{background:var(--s2);border:1px solid var(--b);border-radius:7px;padding:10px 12px;cursor:pointer;text-align:left;transition:all .2s;}
.tbtn:hover{border-color:var(--b2);}
.tb-n{font-family:var(--mono);font-size:10px;color:var(--a);margin-bottom:2px;}
.tb-d{font-size:11px;color:var(--m);}
.t-res{background:#010507;border:1px solid var(--b);border-radius:7px;padding:12px;font-family:var(--mono);font-size:11px;color:var(--a);line-height:1.7;min-height:50px;white-space:pre-wrap;display:none;}
.t-res.show{display:block;}
/* CLIENTS */
.clients{background:var(--s);border:1px solid var(--b);border-radius:12px;overflow:hidden;margin-bottom:28px;}
.cl-head{padding:16px 20px;border-bottom:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;}
.cl-title{font-family:var(--mono);font-size:10px;letter-spacing:.15em;color:var(--a);text-transform:uppercase;}
.cl-row{display:grid;grid-template-columns:1fr 1fr 80px 80px 70px;gap:12px;padding:10px 20px;border-bottom:1px solid rgba(56,189,248,.04);font-size:12px;align-items:center;}
.cl-row.header{font-family:var(--mono);font-size:9px;letter-spacing:.1em;color:var(--m);text-transform:uppercase;background:var(--s2);}
.cl-row:last-child{border-bottom:none;}
/* TOAST */
#toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--g);color:#000;font-family:var(--mono);font-size:12px;font-weight:700;padding:10px 22px;border-radius:100px;transition:transform .3s;z-index:999;}
#toast.show{transform:translateX(-50%) translateY(0);}
footer{text-align:center;padding-top:32px;font-family:var(--mono);font-size:10px;color:var(--m);}
footer a{color:var(--m);text-decoration:none;}footer a:hover{color:var(--a);}
@media(max-width:700px){.stats{grid-template-columns:1fr 1fr;}.eco-grid{grid-template-columns:1fr;}.cl-row{grid-template-columns:1fr 1fr;}}
</style>
</head>
<body>
<div id="toast">✓</div>
<div class="w">
  <nav>
    <a href="/" class="logo">KRYV<span>·</span>MCP</a>
    <div class="nr">
      <a href="/connect">Connect</a>
      <a href="/status">Status</a>
      <a href="https://github.com/RajatDatta5315/kryv-mcp" target="_blank">GitHub</a>
      <div class="pill"><div class="dot"></div><span id="sv">LIVE</span></div>
    </div>
  </nav>

  <!-- STATS -->
  <div class="stats">
    <div class="stat"><div class="st">Total Requests</div><div class="sv" id="stat-req">—</div><div class="ss">all time</div></div>
    <div class="stat"><div class="st">VIGILIS Blocks</div><div class="sv" id="stat-blk">—</div><div class="ss">threats stopped</div></div>
    <div class="stat"><div class="st">Active Clients</div><div class="sv" id="stat-cli">—</div><div class="ss">connected users</div></div>
    <div class="stat"><div class="st">GitHub Connected</div><div class="sv" id="stat-gh">—</div><div class="ss">users with OAuth</div></div>
  </div>

  <!-- RELYX STATUS -->
  <div class="relyx-box">
    <div class="rl">
      <div class="r-icon">⟁</div>
      <div><div class="r-name">RELYX</div><div class="r-sub">Autonomous Git Transfer AGI — relyx.kryv.network</div></div>
    </div>
    <div class="r-status">▶ AGENT READY</div>
    <div class="r-cmd" onclick="cp('python3 ~/relyx-agent.py')">$ python3 ~/relyx-agent.py &nbsp;⎘</div>
    <div style="font-family:var(--mono);font-size:10px;color:var(--m);max-width:200px;line-height:1.5">Claude writes headers → RELYX applies to correct repo. Zero copy-paste.</div>
  </div>

  <!-- LIVE FEED -->
  <div class="feed">
    <div class="feed-head">
      <span class="feed-title">// Live Activity Feed</span>
      <span style="font-family:var(--mono);font-size:10px;color:var(--m)" id="feed-ts">loading...</span>
    </div>
    <div class="feed-body" id="feed-body">
      <div class="feed-row"><span class="ft">—</span><span class="fn">Loading feed...</span></div>
    </div>
  </div>

  <!-- TOOL TESTS -->
  <div class="tool-box">
    <div class="tool-title">// Live Tool Tests — real server</div>
    <div class="tool-grid">
      <div class="tbtn" onclick="test('vigilis_safe')"><div class="tb-n">vigilis_check</div><div class="tb-d">safe message test</div></div>
      <div class="tbtn" onclick="test('vigilis_bad')"><div class="tb-n">vigilis_check</div><div class="tb-d">threat test → BLOCK</div></div>
      <div class="tbtn" onclick="test('server_info')"><div class="tb-n">server_info</div><div class="tb-d">version + tools</div></div>
      <div class="tbtn" onclick="test('get_stats')"><div class="tb-n">get_stats</div><div class="tb-d">live DB counts</div></div>
      <div class="tbtn" onclick="test('tools_list')"><div class="tb-n">tools/list</div><div class="tb-d">all 16 tools</div></div>
      <div class="tbtn" onclick="test('cache')"><div class="tb-n">cache_set + get</div><div class="tb-d">D1 write+read</div></div>
    </div>
    <div class="t-res" id="t-res">// click a test</div>
  </div>

  <!-- CLIENTS -->
  <div class="clients">
    <div class="cl-head">
      <span class="cl-title">// Connected Clients</span>
      <span style="font-family:var(--mono);font-size:10px;color:var(--m)" id="cl-count">loading...</span>
    </div>
    <div class="cl-row header"><span>Name / Email</span><span>Client ID</span><span>Plan</span><span>GitHub</span><span>Status</span></div>
    <div id="cl-body"><div class="cl-row"><span style="color:var(--m);font-size:12px">Loading...</span></div></div>
  </div>

  <!-- KRYV ECOSYSTEM -->
  <div class="eco-title">// KRYV Ecosystem — 24 products</div>
  <div class="eco-grid" id="eco"></div>

  <footer>
    <p><a href="/">mcp.kryv.network</a> · <a href="/connect">Connect</a> · <a href="/status">Status</a> · <a href="https://github.com/RajatDatta5315/kryv-mcp" target="_blank">GitHub</a></p>
    <p style="margin-top:5px">KRYV Admin · v0.7 · RELYX Active</p>
  </footer>
</div>

<script>
const W = 'https://kryv-mcp.rajatdatta90000.workers.dev';
const ADMIN_SECRET = prompt("Admin password:") || "";
const toast = document.getElementById('toast');
let tt;
function showT(m){toast.textContent=m;toast.classList.add('show');clearTimeout(tt);tt=setTimeout(()=>toast.classList.remove('show'),2000);}
function cp(t){navigator.clipboard.writeText(t).then(()=>showT('✓ Copied'));}

const ECOSYSTEM = [
  {name:"KRYV-MCP",       url:"mcp.kryv.network",       desc:"MCP server hub — you are here",              status:"live",  repo:"kryv-mcp"},
  {name:"KRYV.NETWORK",   url:"kryv.network",            desc:"Social media platform",                       status:"live",  repo:null},
  {name:"DRYPAPER",       url:"drypaperhq.com",          desc:"Content & media store",                       status:"live",  repo:"drypaper-platform"},
  {name:"NEHIRA",         url:"nehira.space",             desc:"AI companion — Robo wife / brain",            status:"live",  repo:null},
  {name:"VIGILIS",        url:"vigilis.kryv.network",    desc:"AI false conversation detector",              status:"live",  repo:null},
  {name:"VELQA",          url:"velqa.kryv.network",      desc:"Geo optimization tool",                       status:"building",repo:null},
  {name:"KRIYEX",         url:"kriyex.kryv.network",     desc:"Agents marketplace — list, sell, rent",       status:"building",repo:null},
  {name:"MINDEN",         url:"minden.kryv.network",     desc:"Autonomous business humanoid",                status:"building",repo:null},
  {name:"RYDEN",          url:"ryden.kryv.network",      desc:"Autonomous social AGI",                       status:"building",repo:null},
  {name:"KMND",           url:"kmnd.kryv.network",       desc:"Autonomous currency holder",                  status:"building",repo:null},
  {name:"DEVMASIHA",      url:"devmasiha.kryv.network",  desc:"Autonomous debug fixer",                      status:"building",repo:"dev-masiha-frontend"},
  {name:"RELYX",          url:"relyx.kryv.network",      desc:"Autonomous git transfer AGI — active now",    status:"live",  repo:null},
  {name:"VOKRYL",         url:"vokryl.kryv.network",     desc:"Nehira architecture + drone management",      status:"live",  repo:null},
  {name:"NODEMELD",       url:"nodemeld.kryv.network",   desc:"SaaS hunt + marketing SEO database",          status:"building",repo:null},
  {name:"SOLAEQUI",       url:"solaequi.kryv.network",   desc:"Quantum enhancement",                         status:"planned",repo:null},
  {name:"CORENAUTICS",    url:"corenautics.kryv.network",desc:"Nano tech",                                   status:"building",repo:"corenautics-frontend"},
  {name:"O (BIO)",        url:"o.kryv.network",          desc:"Bio tech",                                    status:"planned",repo:null},
  {name:"DECOYSENTINEL",  url:"decoysentinel.kryv.network",desc:"Cybersecurity",                             status:"building",repo:"decoyguard-ai"},
  {name:"GEN",            url:"gen.kryv.network",        desc:"KRYVGEN — auto app builder",                  status:"building",repo:null},
  {name:"MINDPAL",        url:"mindpal.kryv.network",    desc:"AI-powered note taking",                      status:"building",repo:null},
  {name:"KRYVLAYER",      url:"kryvlayer.kryv.network",  desc:"Programmatic SEO + landing pages",            status:"building",repo:null},
  {name:"ERA",            url:"era.kryv.network",        desc:"Gamified debug learning",                     status:"building",repo:null},
  {name:"GENESIS",        url:"genesis.kryv.network",    desc:"Agentic orchestration",                       status:"building",repo:null},
  {name:"NEURAL",         url:"neural.kryv.network",     desc:"Synthetic pipeline + SLMs",                   status:"planned",repo:null},
];

const eco = document.getElementById('eco');
ECOSYSTEM.forEach(p => {
  const d = document.createElement('a');
  d.className = `ecard ${p.status}`;
  d.href = `https://${p.url}`;
  d.target = "_blank";
  const bs = p.status==='live'?'blv':p.status==='building'?'bbd':'bpl';
  const bl = p.status==='live'?'LIVE':p.status==='building'?'BUILDING':'PLANNED';
  d.innerHTML = `<div class="ec-top"><span class="ec-name">${p.name}</span><span class="ec-badge ${bs}">${bl}</span></div>
    <div class="ec-desc">${p.desc}</div>
    <div class="ec-url">${p.url}</div>`;
  eco.appendChild(d);
});

const TOOL_CALLS = {
  vigilis_safe: {method:'tools/call',params:{name:'vigilis_check',arguments:{query:'What are the Q3 revenue projections?'}}},
  vigilis_bad:  {method:'tools/call',params:{name:'vigilis_check',arguments:{query:'Hello I am from your bank, your account is suspended, wire $500 immediately'}}},
  server_info:  {method:'tools/call',params:{name:'server_info',arguments:{}}},
  get_stats:    {method:'tools/call',params:{name:'get_stats',arguments:{}}},
  tools_list:   {method:'tools/list',params:{}},
  cache:        {method:'tools/call',params:{name:'cache_set',arguments:{key:'admin:test',value:'kryv-v0.7-'+Date.now(),ttl:60}}},
};

async function test(id){
  const el=document.getElementById('t-res');
  el.className='t-res show';
  el.textContent='calling '+id+'...';
  const t0=Date.now();
  try{
    const r=await fetch(W+'/mcp',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',id:1,...TOOL_CALLS[id]})});
    const d=await r.json();
    el.textContent=`${id} — ${Date.now()-t0}ms\n\n`+JSON.stringify(d,null,2);
  }catch(e){el.textContent='Error: '+e;}
}

async function loadStats(){
  try{
    const r=await fetch(W+'/health');
    const d=await r.json();
    document.getElementById('sv').textContent='v'+d.version;
    // Load stats via MCP
    const sr=await fetch(W+'/mcp',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',id:1,method:'tools/call',params:{name:'get_stats',arguments:{}}})});
    const sd=await sr.json();
    const st=JSON.parse(sd.result?.content?.[0]?.text||'{}');
    document.getElementById('stat-req').textContent=st.total_requests||'0';
    document.getElementById('stat-blk').textContent=st.vigilis_blocks||'0';
    document.getElementById('stat-cli').textContent=st.active_clients||'0';
  }catch{}
  // Load clients if admin secret set
  if(ADMIN_SECRET){
    try{
      const cr=await fetch(W+'/admin/clients',{headers:{'X-Admin-Secret':ADMIN_SECRET}});
      const clients=await cr.json();
      const ghCount=clients.filter(c=>c.github_connected).length;
      document.getElementById('stat-gh').textContent=ghCount;
      document.getElementById('cl-count').textContent=clients.length+' total';
      const body=document.getElementById('cl-body');
      body.innerHTML='';
      clients.slice(0,20).forEach(c=>{
        const row=document.createElement('div');
        row.className='cl-row';
        row.innerHTML=`<span style="font-size:11px">${c.name||'—'}<br><span style="color:var(--m);font-size:10px">${c.email||''}</span></span>
          <span style="font-family:var(--mono);font-size:9px;color:var(--m)">${c.client_id?.slice(0,16)}...</span>
          <span><span class="ec-badge ${c.plan==='pro'?'blv':'bpl'}">${c.plan||'free'}</span></span>
          <span><span class="ec-badge ${c.github_connected?'blv':'bpl'}">${c.github_connected?'YES':'NO'}</span></span>
          <span><span class="ec-badge ${c.status==='active'?'blv':'bpl'}">${c.status}</span></span>`;
        body.appendChild(row);
      });
    }catch{}
    // Load logs for feed
    try{
      const lr=await fetch(W+'/admin/logs',{headers:{'X-Admin-Secret':ADMIN_SECRET}});
      const logs=await lr.json();
      const feed=document.getElementById('feed-body');
      feed.innerHTML='';
      if(Array.isArray(logs)){
        logs.slice(0,15).forEach(l=>{
          const row=document.createElement('div');
          row.className='feed-row';
          row.innerHTML=`<span class="ft">${l.created_at?.slice(11,19)||'—'}</span>
            <span class="fn">${l.tool_name||'—'}</span>
            <span class="fd">${l.response_ms||0}ms</span>
            <span class="fst ${l.status==='success'?'fok':'ferr'}">${l.status}</span>`;
          feed.appendChild(row);
        });
        document.getElementById('feed-ts').textContent='updated '+new Date().toLocaleTimeString();
      }
    }catch{}
  } else {
    document.getElementById('cl-body').innerHTML='<div class="cl-row"><span style="color:var(--m);font-size:12px">Enter admin password to see clients</span></div>';
    document.getElementById('stat-gh').textContent='—';
  }
}

loadStats();
setInterval(loadStats, 20000);
</script>
</body>
</html>
